<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abby's Website - Heatmaps</title>
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@300;400&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#f0f0f0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <script src="scripts.js"></script>
</head>
<body>
    <nav>
        <a href="index.html">Home</a>
        <a href="projects.html">Projects</a>
        <a href="coursework.html">Coursework</a>
        <a href="heatmaps.html" class="active">Heatmaps</a>
        <button class="theme-switch" onclick="toggleTheme()">ðŸŒ™ Dark Mode</button>
    </nav>

    <main>
        <div class="terminal-header">
            <div class="terminal-title">Abby:~$ cat activity.log</div>
        </div>

        <!-- Heatmaps section -->
        <section class="heatmaps-section">
            <h2>Activity Tracking</h2>
            
            <!-- GitHub contribution heatmap with advanced features -->
            <div class="heatmap-container">
                <h3>GitHub Contributions</h3>
                <div class="github-heatmap">
                    <div id="github-contribution-chart"></div>
                </div>
                <p class="heatmap-note">Sync status: Live from GitHub</p>
            </div>
            
            <!-- MonkeyType heatmap -->
            <div class="heatmap-container">
                <h3>MonkeyType Activity</h3>
                <div class="monkeytype-heatmap">
                    <iframe id="monkeytype-iframe" src="https://monkeytype.com/embed/profile/drsc" frameborder="0" width="100%" height="400" scrolling="no" style="overflow:hidden"></iframe>
                </div>
                <p class="heatmap-note">Showing typing activity data from MonkeyType</p>
            </div>
            
            <!-- Custom habit tracker heatmaps -->
            <div class="heatmap-container">
                <h3>Habit Tracker</h3>
                <div class="habit-tracker">
                    <div class="habit-item">
                        <div class="habit-name">Meditation</div>
                        <div class="habit-heatmap" id="meditation-heatmap"></div>
                        <div class="habit-stats">
                            <div>Longest Streak: <span id="meditation-streak">0</span> days</div>
                            <div>Current Streak: <span id="meditation-current">0</span> days</div>
                            <div>Total Count: <span id="meditation-total">0</span></div>
                            <div>Average Duration: <span id="meditation-avg">0.00</span> minutes</div>
                        </div>
                        <button class="log-btn" onclick="logHabit('meditation')">Log Today</button>
                    </div>
                    
                    <div class="habit-item">
                        <div class="habit-name">Exercise</div>
                        <div class="habit-heatmap" id="exercise-heatmap"></div>
                        <div class="habit-stats">
                            <div>Longest Streak: <span id="exercise-streak">0</span> days</div>
                            <div>Current Streak: <span id="exercise-current">0</span> days</div>
                            <div>Total Count: <span id="exercise-total">0</span></div>
                            <div>Average Duration: <span id="exercise-avg">0.00</span> minutes</div>
                        </div>
                        <button class="log-btn" onclick="logHabit('exercise')">Log Today</button>
                    </div>
                    
                    <div class="habit-item">
                        <div class="habit-name">Reading</div>
                        <div class="habit-heatmap" id="reading-heatmap"></div>
                        <div class="habit-stats">
                            <div>Longest Streak: <span id="reading-streak">0</span> days</div>
                            <div>Current Streak: <span id="reading-current">0</span> days</div>
                            <div>Total Count: <span id="reading-total">0</span></div>
                            <div>Average Duration: <span id="reading-avg">0.00</span> minutes</div>
                        </div>
                        <button class="log-btn" onclick="logHabit('reading')">Log Today</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="visitor-counter">
            <p>Views: <span id="visitorCount">0</span></p>
        </div>
        <p>Copyright Â© 2024 Abby Li <span class="cursor-blink">_</span></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton();
            
            // Load GitHub contributions with tooltips
            fetchGitHubContributions();
            
            // Initialize habit trackers from scripts.js
            if (typeof initHabitTrackers === 'function') {
                initHabitTrackers();
                loadHabitData();
            }
            
            // Fix MonkeyType iframe height and ensure it's visible
            const monkeyTypeIframe = document.getElementById('monkeytype-iframe');
            if (monkeyTypeIframe) {
                monkeyTypeIframe.onload = function() {
                    this.style.height = '800px';
                };
                
                // Fallback if onload doesn't trigger
                setTimeout(() => {
                    monkeyTypeIframe.style.height = '800px';
                }, 1000);
                
                // If iframe still not showing, try alternative embedding
                setTimeout(() => {
                    if (monkeyTypeIframe.offsetHeight < 100) {
                        const container = document.querySelector('.monkeytype-heatmap');
                        container.innerHTML = `<iframe src="https://monkeytype.com/profile/drsc" 
                                                      frameborder="0" 
                                                      width="100%" 
                                                      height="800px" 
                                                      scrolling="no" 
                                                      style="overflow:hidden; display:block; border-radius: 5px;"></iframe>`;
                    }
                }, 3000);
            }
        });
        
        // Fetch GitHub contributions and display with tooltips
        async function fetchGitHubContributions() {
            const username = 'drsc777';
            const container = document.getElementById('github-contribution-chart');
            
            try {
                // Use GitHub API to get contribution data (fallback to pre-made display if API rate limited)
                container.innerHTML = `<div class="github-fallback">
                    <img src="https://ghchart.rshah.org/${username}" alt="GitHub Contribution Heatmap" />
                    <div class="tooltip">Loading GitHub data...</div>
                </div>`;
                
                // Try multiple APIs for GitHub contributions to ensure something displays
                try {
                    // Try first API
                    const response = await axios.get(`https://github-contributions-api.jogruber.de/v4/${username}?y=last`);
                    if (response.data && response.data.contributions) {
                        renderContributionCalendar(response.data.contributions, container);
                        return;
                    }
                } catch (apiError) {
                    console.log('First API failed, trying alternative:', apiError);
                }
                
                try {
                    // Try alternative API
                    const response = await axios.get(`https://github-contributions.vercel.app/api/v1/${username}`);
                    if (response.data) {
                        renderAlternativeContributionCalendar(response.data, container);
                        return;
                    }
                } catch (apiError) {
                    console.log('Alternative API failed too:', apiError);
                    // Keep the fallback image displayed
                }
            } catch (error) {
                console.error('Error fetching GitHub contributions:', error);
            }
        }
        
        // Get contribution level (0-4) based on count
        function getContributionLevel(count) {
            if (count === 0) return 0;
            if (count <= 3) return 1;
            if (count <= 6) return 2;
            if (count <= 9) return 3;
            return 4;
        }
        
        // Render GitHub contribution calendar with tooltips (primary method)
        function renderContributionCalendar(contributions, container) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            // Group contributions by week
            const weeks = [];
            let currentWeek = [];
            
            contributions.forEach((day, index) => {
                if (index % 7 === 0 && index > 0) {
                    weeks.push(currentWeek);
                    currentWeek = [];
                }
                currentWeek.push(day);
            });
            if (currentWeek.length > 0) {
                weeks.push(currentWeek);
            }
            
            // Build calendar HTML
            let html = '<div class="github-calendar">';
            
            // Add month labels
            html += '<div class="calendar-months">';
            const firstDaysOfMonths = contributions.filter((day, i) => {
                return i === 0 || new Date(day.date).getDate() === 1;
            });
            firstDaysOfMonths.forEach(day => {
                const date = new Date(day.date);
                const month = months[date.getMonth()];
                const offset = Math.floor(weeks.findIndex(week => 
                    week.some(d => d.date === day.date)
                ) * (15 + 2)); // 15px square + 2px gap
                html += `<div class="month-label" style="left: ${offset}px">${month}</div>`;
            });
            html += '</div>';
            
            // Add weekday labels
            html += '<div class="calendar-weekdays">';
            weekdays.forEach((day, i) => {
                if (i % 2 === 0) { // Show only some days to save space
                    html += `<div class="weekday-label">${day}</div>`;
                } else {
                    html += '<div class="weekday-label"></div>';
                }
            });
            html += '</div>';
            
            // Add contribution cells
            html += '<div class="calendar-grid">';
            weeks.forEach(week => {
                html += '<div class="calendar-week">';
                week.forEach(day => {
                    const level = getContributionLevel(day.count);
                    const date = new Date(day.date);
                    const formattedDate = `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
                    html += `<div class="calendar-day level-${level}" data-date="${day.date}" data-count="${day.count}" title="${day.count} contributions on ${formattedDate}"></div>`;
                });
                html += '</div>';
            });
            html += '</div>';
            
            html += '</div>';
            container.innerHTML = html;
            
            // Add tooltips
            const calendarDays = document.querySelectorAll('.calendar-day');
            calendarDays.forEach(day => {
                day.addEventListener('mouseenter', function(event) {
                    const count = this.getAttribute('data-count');
                    const date = new Date(this.getAttribute('data-date'));
                    const formattedDate = `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
                    
                    const tooltip = document.createElement('div');
                    tooltip.className = 'gh-tooltip';
                    tooltip.innerHTML = `<div class="tooltip-date">${formattedDate}</div>
                                        <div class="tooltip-count">${count} contribution${count !== '1' ? 's' : ''}</div>`;
                    
                    // Position tooltip
                    const rect = this.getBoundingClientRect();
                    tooltip.style.top = `${rect.top - 60}px`;
                    tooltip.style.left = `${rect.left - 60}px`;
                    
                    document.body.appendChild(tooltip);
                    
                    this.addEventListener('mouseleave', function() {
                        document.querySelectorAll('.gh-tooltip').forEach(t => t.remove());
                    }, { once: true });
                });
            });
        }
        
        // Render GitHub contribution calendar using alternative API format
        function renderAlternativeContributionCalendar(data, container) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            // Extract contributions
            const contributions = [];
            
            // Process the contributions from the alternative API format
            if (data.contributions) {
                Object.entries(data.contributions).forEach(([date, count]) => {
                    contributions.push({
                        date: date,
                        count: count
                    });
                });
            }
            
            // Sort by date
            contributions.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Group contributions by week
            const weeks = [];
            let currentWeek = [];
            let dayOfWeek = new Date(contributions[0].date).getDay();
            
            // Add empty days at the beginning if needed
            for (let i = 0; i < dayOfWeek; i++) {
                currentWeek.push({
                    date: '',
                    count: 0
                });
            }
            
            contributions.forEach((day) => {
                const date = new Date(day.date);
                dayOfWeek = date.getDay();
                
                currentWeek.push(day);
                
                if (dayOfWeek === 6) { // Saturday, end of week
                    weeks.push(currentWeek);
                    currentWeek = [];
                }
            });
            
            // Add the last week if it's not complete
            if (currentWeek.length > 0) {
                weeks.push(currentWeek);
            }
            
            // Build calendar HTML
            let html = '<div class="github-calendar">';
            
            // Add month labels
            html += '<div class="calendar-months">';
            const monthsInContributions = [...new Set(contributions.map(day => 
                new Date(day.date).getMonth()
            ))];
            
            monthsInContributions.forEach((monthIndex, i) => {
                const offset = Math.floor(i * (weeks.length / monthsInContributions.length) * 17);
                html += `<div class="month-label" style="left: ${offset}px">${months[monthIndex]}</div>`;
            });
            html += '</div>';
            
            // Add weekday labels
            html += '<div class="calendar-weekdays">';
            weekdays.forEach((day, i) => {
                if (i % 2 === 0) { // Show only some days to save space
                    html += `<div class="weekday-label">${day}</div>`;
                } else {
                    html += '<div class="weekday-label"></div>';
                }
            });
            html += '</div>';
            
            // Add contribution cells
            html += '<div class="calendar-grid">';
            weeks.forEach(week => {
                html += '<div class="calendar-week">';
                week.forEach(day => {
                    if (!day.date) {
                        // Empty cell for padding at the start
                        html += `<div class="calendar-day empty"></div>`;
                    } else {
                        const level = getContributionLevel(day.count);
                        const date = new Date(day.date);
                        const formattedDate = `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
                        html += `<div class="calendar-day level-${level}" data-date="${day.date}" data-count="${day.count}" title="${day.count} contributions on ${formattedDate}"></div>`;
                    }
                });
                html += '</div>';
            });
            html += '</div>';
            
            html += '</div>';
            container.innerHTML = html;
            
            // Add tooltips
            const calendarDays = document.querySelectorAll('.calendar-day:not(.empty)');
            calendarDays.forEach(day => {
                day.addEventListener('mouseenter', function(event) {
                    if (!this.dataset.date) return;
                    
                    const count = this.getAttribute('data-count');
                    const date = new Date(this.getAttribute('data-date'));
                    const formattedDate = `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
                    
                    const tooltip = document.createElement('div');
                    tooltip.className = 'gh-tooltip';
                    tooltip.innerHTML = `<div class="tooltip-date">${formattedDate}</div>
                                        <div class="tooltip-count">${count} contribution${count !== '1' ? 's' : ''}</div>`;
                    
                    // Position tooltip
                    const rect = this.getBoundingClientRect();
                    tooltip.style.top = `${rect.top - 60}px`;
                    tooltip.style.left = `${rect.left - 60}px`;
                    
                    document.body.appendChild(tooltip);
                    
                    this.addEventListener('mouseleave', function() {
                        document.querySelectorAll('.gh-tooltip').forEach(t => t.remove());
                    }, { once: true });
                });
            });
        }
    </script>
</body>
</html> 